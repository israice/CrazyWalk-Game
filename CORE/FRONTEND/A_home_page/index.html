<!DOCTYPE html>
<html lang="en">

<head>
    <script>
        // CLEANUP: Force clear all local domain data on entry
        try {
            localStorage.clear();
            sessionStorage.clear();
            if ('caches' in window) {
                caches.keys().then(names => {
                    for (let name of names) caches.delete(name);
                });
            }
            console.log("Domain storage cleared.");
        } catch (e) {
            console.warn("Storage cleanup failed:", e);
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CrazyWalk</title>
    <script>
        // Mask URL to show only root address
        window.history.replaceState(null, '', '/');
    </script>
    <link rel="icon" type="image/png" href="/A_home_page/components/crazywalk_logo.png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/A_home_page/manifest.json">
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Professional "Bio-Digital" Palette */
            --primary-color: #00ff9d;
            --secondary-color: #00b8ff;
            --glass-bg: rgba(5, 20, 10, 0.7);
            --glass-border: rgba(0, 255, 157, 0.2);
            --text-glow: 0 0 15px rgba(0, 255, 157, 0.4);
        }

        /* ========== LIQUID GLASS EFFECT ========== */
        .liquid-glass {
            position: relative;
            background: linear-gradient(135deg,
                    rgba(255, 255, 255, 0.1) 0%,
                    rgba(255, 255, 255, 0.02) 50%,
                    rgba(255, 255, 255, 0.08) 100%);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.25),
                inset 0 -1px 0 rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        /* Animated shine sweep */
        .liquid-glass::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -100%;
            width: 60%;
            height: 200%;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.2) 50%, transparent 100%);
            transform: skewX(-25deg);
            animation: liquidShine 5s ease-in-out infinite;
            pointer-events: none;
            z-index: 10;
        }

        @keyframes liquidShine {
            0% {
                left: -100%;
                opacity: 0;
            }

            20% {
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                left: 200%;
                opacity: 0;
            }
        }

        /* Chromatic aberration border */
        .liquid-glass::after {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: inherit;
            background: linear-gradient(45deg,
                    rgba(0, 255, 157, 0.5) 0%,
                    rgba(0, 184, 255, 0.4) 25%,
                    rgba(180, 100, 255, 0.4) 50%,
                    rgba(0, 184, 255, 0.4) 75%,
                    rgba(0, 255, 157, 0.5) 100%);
            background-size: 400% 400%;
            z-index: -1;
            opacity: 0.7;
            animation: chromaticPulse 6s ease infinite;
            filter: blur(6px);
        }

        @keyframes chromaticPulse {

            0%,
            100% {
                background-position: 0% 50%;
            }

            25% {
                background-position: 100% 0%;
            }

            50% {
                background-position: 100% 100%;
            }

            75% {
                background-position: 0% 100%;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            width: 100vw;
            height: 100vh;
            /* Fallback for older browsers */
            height: 100dvh;
            /* Dynamic viewport height for mobile browsers */
            overflow: hidden;
            background-color: black;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Poppins', sans-serif;
            color: white;
            -webkit-user-select: none;
            /* Safari */
            -ms-user-select: none;
            /* IE 10 and IE 11 */
            user-select: none;
            /* Standard syntax */
            -webkit-tap-highlight-color: transparent;
            /* Remove tap highlight on mobile */
            touch-action: none;
            /* Prevent default touch actions like scroll/zoom */
        }

        .black-square {
            position: absolute;
            width: 42vh;
            height: 72vh;
            background-color: #050505;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 0;
            overflow: hidden;
            border-radius: 3vh;
            /* Rounded corners like a phone screen */
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.15);
        }

        #map {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050505;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            z-index: 1;
            /* Map Filter: Deep Black BG + Cool Mint/Green Roads 
               Using a hue-rotate around 110deg on sepia creates a nice minty green.
            */
            filter: brightness(2) contrast(1.4) sepia(100%) hue-rotate(110deg) saturate(3.5);
        }

        #loading-gif {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 500;
            background: black;
            transition: opacity 0.6s ease-out;
        }

        /* FULL HEIGHT FLEX CONTAINER */
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            display: flex;
            flex-direction: column;
            padding: 4vh 2.5vh 3vh 2.5vh;
            /* Top, Right, Bottom, Left */
            pointer-events: auto;
            /* background: transparent; */
        }

        /* 1. HEADER section */
        .header {
            text-align: center;
            flex-shrink: 0;
            margin-bottom: 1vh;
        }

        .logo-img {
            height: 12vh;
            /* Adjusted size */
            width: auto;
            filter: drop-shadow(0 0 5px rgba(0, 243, 255, 0.8));
            animation: pulse 3s infinite alternate;
            margin-bottom: 1vh;
        }

        @keyframes pulse {
            to {
                transform: scale(1.05);
                filter: drop-shadow(0 0 10px rgba(0, 255, 136, 0.6));
            }
        }

        h1 {
            font-size: 3.2vh;
            font-weight: 800;
            margin: 0.5vh 0 0;
            line-height: 1;
            background: linear-gradient(to right, #fff, #ddd);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h2 {
            font-size: 1.3vh;
            font-weight: 600;
            color: var(--secondary-color);
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: 0.3vh;
            opacity: 0.9;
        }

        /* 2. MIDDLE SECTION (Menu + Legal) - Flex Grow to take space */
        .middle-section {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 1.5vh;
            width: 100%;
        }

        .menu-links {
            display: flex;
            flex-direction: column;
            gap: 1vh;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 1.5vh;
            padding: 1.2vh 1.5vh;
            border-radius: 1.5vh;
            /* Liquid Glass styling */
            position: relative;
            background: linear-gradient(135deg,
                    rgba(5, 25, 15, 0.85) 0%,
                    rgba(0, 30, 40, 0.7) 100%);
            border: 1px solid rgba(0, 255, 157, 0.3);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.35),
                inset 0 1px 0 rgba(255, 255, 255, 0.15),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            cursor: pointer;
            overflow: hidden;
        }

        /* Liquid Glass shine on menu items */
        .menu-item::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -100%;
            width: 50%;
            height: 200%;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.15) 50%, transparent 100%);
            transform: skewX(-25deg);
            animation: menuShine 6s ease-in-out infinite;
            pointer-events: none;
            z-index: 5;
        }

        @keyframes menuShine {
            0% {
                left: -100%;
                opacity: 0;
            }

            15% {
                opacity: 0.8;
            }

            35% {
                opacity: 0.8;
            }

            50% {
                left: 200%;
                opacity: 0;
            }

            100% {
                left: 200%;
                opacity: 0;
            }
        }

        /* Chromatic glow on hover */
        .menu-item::after {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: inherit;
            background: linear-gradient(45deg,
                    rgba(0, 255, 157, 0.4),
                    rgba(0, 184, 255, 0.3),
                    rgba(157, 78, 255, 0.3),
                    rgba(0, 255, 157, 0.4));
            background-size: 300% 300%;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.4s ease;
            animation: glowShift 4s ease infinite;
            filter: blur(4px);
        }

        @keyframes glowShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .menu-item:hover::after {
            opacity: 1;
        }

        .menu-item:hover {
            border-color: rgba(0, 255, 157, 0.6);
            box-shadow:
                0 8px 32px rgba(0, 255, 157, 0.2),
                0 0 25px rgba(0, 255, 157, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .menu-item:active {
            transform: scale(0.97);
        }

        .menu-item span {
            font-size: 1.5vh;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .icon-circle {
            width: 3vh;
            height: 3vh;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4vh;
            background: rgba(255, 255, 255, 0.1);
        }

        .icon-info {
            color: var(--primary-color);
        }

        .icon-video {
            color: #ff4757;
        }

        /* Legal - Centered Links */
        .legal-section {
            width: 100%;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            gap: 2vh;
            margin-bottom: 1vh;
            flex-shrink: 0;
        }

        .legal-item {
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.2vh;
            text-decoration: none;
            transition: color 0.3s;
            position: relative;
        }

        .legal-item::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 1px;
            bottom: -2px;
            left: 0;
            background-color: rgba(255, 255, 255, 0.3);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .legal-item:hover {
            color: white;
        }

        .legal-item:hover::after {
            transform: scaleX(1);
        }

        /* 3. BOTTOM ACTIONS */
        .action-buttons {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 1vh;
            margin-top: 0.5vh;
        }

        .btn {
            width: 100%;
            padding: 1.5vh;
            border-radius: 1.5vh;
            font-size: 1.6vh;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-login {
            background: linear-gradient(90deg, #00ff9d 0%, #00b8ff 100%);
            color: black;
            box-shadow: 0 4px 20px rgba(0, 255, 157, 0.4);
            font-weight: 800;
        }

        .btn-guest {
            background: white;
            font-size: 2.0vh;
            font-weight: bold;
            color: black;
            border: 1px solid white;
            backdrop-filter: none;
        }

        /* City Label - Now part of the flex flow */
        #city-label {
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 3vh;
            font-weight: 600;
            letter-spacing: 2px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 1s;
            text-transform: uppercase;
            margin-top: 6vh;
            /* Spacing from buttons */
        }

        img.iphone-frame {
            height: 100vh;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 200;
            pointer-events: none;
            filter: drop-shadow(0 20px 50px rgba(0, 0, 0, 0.9));
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            img.iphone-frame {
                display: none !important;
            }

            .black-square {
                width: 100vw;
                height: 100vh;
                border-radius: 0;
                box-shadow: none;
                background-color: black;
            }

            .ui-overlay {
                /* Floating HUD in center, matching desktop size */
                width: 90vh;
                height: 90vh;
                max-width: 100vw;
                /* Safety */
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                padding: 4vh 2.5vh 3vh 2.5vh;
                /* Restore desktop padding */
                border-radius: 3vh;
                /* Optional: smooth corners for the gradient box */
                justify-content: space-between;
                /* Ensure vertical spacing matches desktop */
            }

            /* RESTORED & INCREASED fonts for mobile readability */
            .logo-img {
                height: 15vh;
                /* Larger on mobile */
            }

            h1 {
                font-size: 5vh;
            }

            h2 {
                font-size: 2.5vh;
            }

            .btn {
                font-size: 3vh;
                padding: 2.5vh;
            }

            .menu-item span {
                font-size: 2.5vh;
            }

            .icon-circle {
                width: 5vh;
                height: 5vh;
                font-size: 2.5vh;
            }

            .legal-item {
                font-size: 1.8vh;
            }

            #city-label {
                /* Pin inside the floating overlay or relative to it? 
                   The label is outside ui-overlay in DOM (child of black-square).
                   Since black-square is full screen, city-label is at bottom of SCREEN.
                   To match "same place", we should move it or adjust it.
                   User said "located in the same places". 
                   On desktop, city-label is at bottom of black-square (72vh).
                   On mobile, black-square is 100vh.
                   So city-label is at bottom of screen (100vh).
                   This is probably fine as it leaves the map clear.
                   But if user insists strictly "same place relative to UI",
                   we might need to move it. 
                   "located in the same places in the center of the screen" implies the whole composition.
                   Let's keep city-label at screen bottom for now as it looks better map-wise, 
                   or move it up to 12vh from center bottom?
                   Let's stick to screen bottom for better map visibility and cleaner UI box.
                */
                font-size: 5vh;
                bottom: 12vh;
                /* Lift slightly on mobile */
            }
        }

        /* ERROR SCREEN */
        #error-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ff0033;
            /* Bright Red */
            z-index: 1000;
            display: none;
            /* Hidden by default */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 5vh;
        }

        #error-screen h1 {
            font-size: 4vh;
            color: white;
            background: none;
            -webkit-text-fill-color: white;
            margin-bottom: 2vh;
        }

        #error-screen p {
            font-size: 2vh;
            color: white;
            opacity: 0.9;
            max-width: 80%;
            margin-bottom: 4vh;
        }

        .btn-retry {
            background: white;
            color: #ff0033;
            border: none;
            padding: 1.5vh 4vh;
            font-size: 2vh;
            font-weight: 700;
            border-radius: 1vh;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }

        .btn-retry:active {
            transform: scale(0.95);
        }
    </style>
</head>

<body>
    <!-- SVG Filters for Liquid Glass Refraction Effect -->
    <svg style="position: absolute; width: 0; height: 0;" aria-hidden="true">
        <defs>
            <filter id="liquidGlassFilter" x="-20%" y="-20%" width="140%" height="140%">
                <feTurbulence type="fractalNoise" baseFrequency="0.02 0.015" numOctaves="3" seed="5" result="noise">
                    <animate attributeName="baseFrequency" values="0.02 0.015;0.025 0.02;0.02 0.015" dur="10s"
                        repeatCount="indefinite" />
                </feTurbulence>
                <feDisplacementMap in="SourceGraphic" in2="noise" scale="4" xChannelSelector="R" yChannelSelector="G" />
            </filter>
            <filter id="glassGlow" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur in="SourceAlpha" stdDeviation="10" result="blur" />
                <feFlood flood-color="rgba(0, 255, 157, 0.6)" result="color" />
                <feComposite in="color" in2="blur" operator="in" result="glow" />
                <feMerge>
                    <feMergeNode in="glow" />
                    <feMergeNode in="SourceGraphic" />
                </feMerge>
            </filter>
        </defs>
    </svg>

    <div class="black-square">
        <div id="map"></div>
        <img id="loading-gif" src="/A_home_page/components/earth.gif" alt="Loading...">

        <!-- Red Error Screen -->
        <div id="error-screen">
            <i class="fa-solid fa-triangle-exclamation" style="font-size: 8vh; color: white; margin-bottom: 2vh;"></i>
            <h1>CONNECTION ERROR</h1>
            <p id="error-message">Unable to verify location. <br> Please check your internet or GPS settings.</p>
            <button class="btn-retry" id="retry-btn">RETRY</button>
        </div>

        <div class="ui-overlay" id="ui-overlay">
            <div class="header">
                <img src="/A_home_page/components/crazywalk_logo.png" class="logo-img" alt="CrazyWalk Logo">
                <h1>CrazyWalk</h1>
                <h2>Walk & Earn Game</h2>
            </div>

            <!-- Middle Section: Grows to fill space -->
            <div class="middle-section">
                <div class="menu-links">
                    <div class="menu-item">
                        <div class="icon-circle icon-info"><i class="fa-solid fa-info"></i></div>
                        <span>Step By Step Instructions</span>
                    </div>
                    <div class="menu-item">
                        <div class="icon-circle icon-video"><i class="fa-solid fa-play"></i></div>
                        <span>Video Explanation</span>
                    </div>
                </div>

            </div>

            <!-- Legal Links Centered Above Login -->
            <div class="legal-section">
                <a href="#" class="legal-item">Terms of Use</a>
                <a href="#" class="legal-item">Privacy Policy</a>
            </div>

            <div class="action-buttons">
                <button class="btn btn-login">LOGIN</button>
                <button class="btn btn-guest">GUEST</button>
            </div>

            <!-- Moved City Label Inside Overlay -->
            <div id="city-label"></div>
        </div>
    </div>
    <img class="iphone-frame" src="/A_home_page/components/iphone.png" alt="iphone">

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cityLabel = document.getElementById('city-label');
            const mapElement = document.getElementById('map');
            const loadingGif = document.getElementById('loading-gif');
            const uiOverlay = document.getElementById('ui-overlay');
            const errorScreen = document.getElementById('error-screen');
            const errorMessage = document.getElementById('error-message');

            // Initial state: GIF visible, UI hidden
            loadingGif.style.display = 'block';
            loadingGif.style.opacity = '1';
            mapElement.style.opacity = '0';
            cityLabel.style.opacity = '0';
            uiOverlay.style.opacity = '0';

            const revealContent = () => {
                loadingGif.style.opacity = '0';
                mapElement.style.opacity = '1';
                cityLabel.style.opacity = '1';
                uiOverlay.style.opacity = '1';
                setTimeout(() => { loadingGif.style.display = 'none'; }, 600);
            };

            const showError = (msg) => {
                // On mobile, avoid the "Red Screen" overlay issues
                if (window.innerWidth <= 1024) {
                    const plainMsg = msg.replace(/<br>/g, '\n').replace(/<[^>]*>/g, '');
                    setTimeout(() => {
                        alert(plainMsg);
                    }, 100);
                    revealContent();
                    return;
                }

                loadingGif.style.display = 'none';
                uiOverlay.style.display = 'none';
                mapElement.style.display = 'none';
                errorScreen.style.display = 'flex';
                errorMessage.innerHTML = msg;
            };

            const map = L.map('map', {
                zoomControl: false,
                attributionControl: false,
                dragging: false,
                touchZoom: false,
                doubleClickZoom: false,
                scrollWheelZoom: false,
                boxZoom: false,
                keyboard: false
            });

            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', {
                maxZoom: 20,
                subdomains: 'abcd'
            }).addTo(map);

            // IP-based location detection (no permission needed)
            const loadIPLocation = () => {
                console.log("DEBUG: Loading city from IP address...");

                fetch('/api/ip_locate')
                    .then(r => r.json())
                    .then(data => {
                        console.log("DEBUG: IP Location data:", data);
                        const cityName = data.city || "UNKNOWN CITY";
                        cityLabel.textContent = cityName;

                        // If we have coordinates, show that location on map
                        if (data.lat && data.lon && data.lat !== 0) {
                            map.setView([data.lat, data.lon], 12, { animate: false });
                        } else {
                            // Default view (world center)
                            map.setView([0, 0], 2, { animate: false });
                        }

                        revealContent();
                        console.log("DEBUG: [SUCCESS] IP-based location loaded!");
                    })
                    .catch(err => {
                        console.error("DEBUG: IP lookup failed:", err);
                        cityLabel.textContent = "WELCOME";
                        map.setView([0, 0], 2, { animate: false });
                        revealContent();
                    });
            };

            // GPS geolocation (requires user permission) - called on GUEST button
            const requestGPSLocation = () => {
                console.log("DEBUG: [Step 1] Requesting GPS permission...");

                if (!("geolocation" in navigator)) {
                    console.error("DEBUG: Geolocation not supported");
                    // Still navigate to map, will use IP-based location there
                    window.location.href = '/B_map_page/index.html';
                    return;
                }

                // Show loading indicator
                loadingGif.style.display = 'block';
                loadingGif.style.opacity = '1';

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        console.log("DEBUG: [Step 2] GPS Permission GRANTED!");
                        const userLat = position.coords.latitude;
                        const userLon = position.coords.longitude;
                        console.log(`DEBUG: GPS Coordinates: [${userLat}, ${userLon}]`);

                        // Store GPS coords in sessionStorage for map page
                        sessionStorage.setItem('gps_lat', userLat);
                        sessionStorage.setItem('gps_lon', userLon);
                        sessionStorage.setItem('gps_enabled', 'true');

                        // Navigate to map page
                        window.location.href = '/B_map_page/index.html';
                    },
                    (error) => {
                        console.warn("DEBUG: GPS Error:", error.message);
                        // GPS failed, but still allow navigation - map will use IP or default
                        sessionStorage.setItem('gps_enabled', 'false');
                        window.location.href = '/B_map_page/index.html';
                    },
                    { enableHighAccuracy: false, timeout: 10000, maximumAge: 60000 }
                );
            };

            // Retry button for error screen
            document.getElementById('retry-btn').addEventListener('click', loadIPLocation);

            // GUEST Button - Request GPS then navigate to map
            document.querySelector('.btn-guest').addEventListener('click', () => {
                console.log("DEBUG: GUEST button clicked. Requesting GPS permission...");
                requestGPSLocation();
            });

            // LOGIN Button (placeholder)
            document.querySelector('.btn-login').addEventListener('click', () => {
                console.log("DEBUG: LOGIN button clicked.");
                // TODO: Implement login flow
                alert("Login feature coming soon!");
            });

            // Initial load - use IP-based location (no permission popup)
            setTimeout(loadIPLocation, 1000);
        });
    </script>
</body>

</html>